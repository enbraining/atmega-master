# 라이브러리

인터럽트를 사용하기 위해서는 `avr/interrupt.h` 라이브러리가 필요하다.

# 설정

## SREG

모든 인터럽트를 활성화시키는 비트가 SREG의 맨 앞에 존재하기 때문에 0x80이라는 값을 기본적으로 사용한다.

```
SREG = 0x80;
```

## EIMSK

특정 인터럽트를 활성화/비활성화 시키기 위해서 사용한다. 인터럽트 번호는 맨 앞에서 7부터 0까지이다.

```c
// 7번 인터럽트를 활성화시킨다.
EIMSK = 0b10000000;

// 혹은 이렇게 사용할 수 있다.
EIMSK = (1 << INT7);
```

## EICRn

인터럽트가 실행될 트리거를 설정하기 위해서 사용한다. EICRA는 좌측부터 3부터 0까지, EICRB는 좌측부터 7부터 4까지이다.

|ISCn1|ISCn0|Description|
|---|---|---|
|0|0|누르고 있는 동안 인터럽트가 실행된다. (로우 레벨)|
|0|1|인터럽트를 사용하지 않는다.|
|1|0|눌렀을 때 인터럽트가 실행된다. (하강 에지)|
|1|1|떼었을 때 인터럽트가 실행된다. (상승 에지)|

```c
// 3번 인터럽트 (INT3)가 하강 에지일 때 실행된다.
EICRA = 0b10000000;

// 6번 인터럽트 (INT6)가 상승 에지일 때 실행된다.
EICRB = 0b00110000;

/*
  혹은 이런 방식으로도 사용할 수 있다.
  ISC31을 1로 설정해서, 3번 인터럽트 (INT3)을 하강 에지로 설정한다.
*/
EICRA = (1 << ISC31);
```

## 전체 코드

```c
#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>

int main()
{
  DDRA = 0xff;
  PORTA = 0x00;

  SREG = 0x80;
  EIMSK = (1 << INT0) | (1 << INT1);
  EICRA = (1 << ISC01) | (1 << ISC11);
}

ISR(INT0_vect)
{
  PORTA = ~PORTA;
}
```
